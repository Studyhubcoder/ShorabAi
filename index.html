<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Chatbot</title>
<style>
* { box-sizing: border-box; }

body {
  font-family: Poppins, sans-serif;
  background: linear-gradient(135deg,#667eea,#764ba2);
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  margin: 0;
}

.chat-wrapper {
  width: 100%;
  height: 100%;
  background: #fff;
  border-radius: 20px;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* Header */
.chat-header {
  background: linear-gradient(135deg,#6b73ff,#000dff);
  color: white;
  padding: 15px;
  font-weight: 600;
}

.chat-header button {
  float: right;
  background: transparent;
  border: none;
  color: white;
  font-size: 18px;
  cursor: pointer;
  margin-left: 8px;
}

/* Chat */
.chat-box {
  flex: 1;
  padding: 15px;
  overflow-y: auto;
  background: #f7f8fc;
}

.chat-message {
  margin: 10px 0;
  max-width: 80%;
}

.bot-message {
  background: #e8e8ef;
  padding: 12px 16px;
  border-radius: 18px 18px 18px 5px;
}

.user-message {
  background: #4a6cf7;
  color: white;
  padding: 12px 16px;
  border-radius: 18px 18px 5px 18px;
  margin-left: auto;
}

small {
  display: block;
  font-size: 11px;
  opacity: 0.6;
  margin-top: 4px;
}

/* Input */
.input-area {
  display: flex;
  border-top: 1px solid #ddd;
  padding: 10px;
}

.input-area input {
  flex: 1;
  border: none;
  padding: 12px;
  border-radius: 25px;
  background: #f1f2f6;
  outline: none;
}

.input-area button {
  margin-left: 8px;
  border: none;
  padding: 12px 15px;
  border-radius: 50%;
  cursor: pointer;
}

#send-btn { background:#667eea;color:white;border-radius:25px;padding:12px 20px;}
#voice-btn { background:#ff4d4d;color:white;}
#image-btn { background:#28a745;color:white;margin:10px;border-radius:10px;}

/* Typing */
.typing { font-style: italic; opacity: 0.6; }

/* Dark mode */
.dark-mode { background:#121212; }
.dark-mode .chat-wrapper { background:#1e1e1e; }
.dark-mode .chat-box { background:#121212; }
.dark-mode .bot-message { background:#2a2a2a;color:#eee; }
</style>
</head>
<body>

<div class="chat-wrapper">

  <div class="chat-header">
    ü§ñ AI Assistant
    <button type="button" id="theme-btn">üåô</button>
    <button type="button" id="speaker-btn">üîä</button>
    <button type="button" id="clear-btn">üóë</button>
  </div>

  <button type="button" id="image-btn">üñº Upload Image</button>
  <input type="file" id="image-input" accept="image/*" hidden>

  <div class="chat-box" id="chat-box">
    <div class="chat-message bot-message">
      Hello! How can I help you?
      <small>--:--</small>
    </div>
  </div>

  <div class="input-area">
    <input type="text" id="user-input" placeholder="Type or speak..." />
    <button type="button" id="voice-btn">üé§</button>
    <button type="button" id="send-btn">Send</button>
  </div>

</div>

<script>
const API_KEY = "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"; // ‚ö†Ô∏è LOCAL USE ONLY!
const API_URL = "https://api.openai.com/v1/chat/completions";

const chatBox = document.getElementById("chat-box");
const userInput = document.getElementById("user-input");
const sendBtn = document.getElementById("send-btn");
const voiceBtn = document.getElementById("voice-btn");
const imageBtn = document.getElementById("image-btn");
const imageInput = document.getElementById("image-input");
const themeBtn = document.getElementById("theme-btn");
const clearBtn = document.getElementById("clear-btn");
const speakerBtn = document.getElementById("speaker-btn");

let messages = [{ role:"system", content:"You are a friendly AI assistant." }];
let voiceEnabled = true;

/* Time */
function timeNow(){
  return new Date().toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
}

/* Append message */
function appendMessage(text,sender){
  const div = document.createElement("div");
  div.className = "chat-message " + (sender==="user"?"user-message":"bot-message");
  div.innerHTML = text + `<small>${timeNow()}</small>`;
  chatBox.appendChild(div);
  chatBox.scrollTop = chatBox.scrollHeight;
}

/* Clear chat */
clearBtn.onclick = () => {
  chatBox.innerHTML = "";
  messages = [{ role:"system", content:"You are a friendly AI assistant." }];
};

/* Theme */
themeBtn.onclick = () => {
  document.body.classList.toggle("dark-mode");
  themeBtn.textContent = document.body.classList.contains("dark-mode") ? "‚òÄÔ∏è" : "üåô";
};

/* Voice output toggle */
speakerBtn.onclick = () => {
  voiceEnabled = !voiceEnabled;
  if(!voiceEnabled){
    speechSynthesis.cancel(); // STOP all speech immediately
  }
  speakerBtn.textContent = voiceEnabled ? "üîä" : "üîá";
};

/* Speak function */
function speak(text){
  if(!voiceEnabled) return;
  speechSynthesis.cancel(); // cancel previous speech
  const utterance = new SpeechSynthesisUtterance(text);
  utterance.lang = "en-US";
  speechSynthesis.speak(utterance);
}

/* Voice input (safe) */
let recognition = null;
if("webkitSpeechRecognition" in window){
  recognition = new webkitSpeechRecognition();
  recognition.lang = "en-US";
  recognition.continuous = false;
  recognition.onresult = e => {
    userInput.value = e.results[0][0].transcript;
    userInput.focus();
  };
} else {
  voiceBtn.disabled = true;
  voiceBtn.textContent = "‚ùå";
}

voiceBtn.onclick = () => recognition && recognition.start();

/* Send message */
sendBtn.onclick = sendMessage;
userInput.addEventListener("keypress", e => { if(e.key==="Enter") sendMessage(); });

async function sendMessage(){
  const text = userInput.value.trim();
  if(!text) return;

  appendMessage(text,"user");
  messages.push({role:"user",content:text});
  userInput.value = "";
  userInput.focus();

  const typing = document.createElement("div");
  typing.className = "chat-message bot-message typing";
  typing.textContent = "Typing...";
  chatBox.appendChild(typing);

  try{
    const res = await fetch(API_URL,{
      method:"POST",
      headers:{
        "Content-Type":"application/json",
        "Authorization":`Bearer ${API_KEY}`
      },
      body:JSON.stringify({
        model:"gpt-4o-mini",
        messages:messages
      })
    });

    const data = await res.json();
    const reply = data.choices[0].message.content;

    messages.push({role:"assistant",content:reply});
    typing.remove();
    appendMessage(reply,"bot");
    speak(reply);
  }catch{
    typing.textContent="‚ö†Ô∏è Error connecting";
  }
}

/* Image upload */
imageBtn.onclick = () => imageInput.click();

imageInput.onchange = () => {
  const file = imageInput.files[0];
  if(!file) return;

  appendMessage("üñº Image uploaded","user");

  const reader = new FileReader();
  reader.onload = async () => {
    const typing = document.createElement("div");
    typing.className = "chat-message bot-message typing";
    typing.textContent = "Analyzing image...";
    chatBox.appendChild(typing);

    const res = await fetch(API_URL,{
      method:"POST",
      headers:{
        "Content-Type":"application/json",
        "Authorization":`Bearer ${API_KEY}`
      },
      body:JSON.stringify({
        model:"gpt-4o-mini",
        messages:[{
          role:"user",
          content:[
            {type:"text",text:"Describe this image"},
            {type:"image_url",image_url:{url:reader.result}}
          ]
        }]
      })
    });

    const data = await res.json();
    typing.remove();
    appendMessage(data.choices[0].message.content,"bot");
    speak(data.choices[0].message.content);
  };
  reader.readAsDataURL(file);
};
</script>

</body>
</html>
